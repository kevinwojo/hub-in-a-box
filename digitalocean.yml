---
 - hosts: localhost 

   vars:
    region: 'nyc3'
    image: 'centos-6-x64'
    
   tasks:
   
   - include_vars: "deploysecrets.yml"

   - name: Ensure droplet exists
     local_action:
      module: digital_ocean
      state: present
      command: droplet
      name: "{{ hub_hostname }}"
      unique_name: yes
      size_id: 1Gb
      region_id: "{{ region }}"
      image_id: "{{ image }}"
      api_token: "{{ digitalocean_api_token }}"
     register: droplet_details
 
   - name: Create DNS entries
     local_action:
      module: digital_ocean_domain
      state: present
      name: "{{ hub_hostname }}"
      ip: "{{ droplet_details.droplet.ip_address }}"
      api_token: "{{ digitalocean_api_token }}"
